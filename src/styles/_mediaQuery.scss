// Code fount at https://stackoverflow.com/questions/62528918/media-query-scss-breakpoints-best-practice
// found: 2023-08-31, updated: 2026-01-30

$breakpoints: (
  mobile: 0,
  phone: 480px,
  tablet: 720px,
  desktopSmall: 960px,
  desktop: 1240px,
  desktopLarge: 1920px,
) !default;

:root {
  @each $name, $value in $breakpoints {
    --breakpoint-#{$name}: #{$value};
  }
}

/**
 * Get breakpoint value by name
 * @param {string} $name - Breakpoint name from $breakpoints map
 * @return {string} - Breakpoint value
 * @throws Error if breakpoint name doesn't exist
 */
@function breakpoint($name) {
  @if not map-has-key($breakpoints, $name) {
    @error "Breakpoint `#{$name}` not found. Available breakpoints: #{map-keys($breakpoints)}";
  }
  @return map-get($breakpoints, $name);
}

/**
 * Media query
 * @param {string} $from - Starting breakpoint 
 * @param {string} $to - Ending breakpoint
 * @param {string} $mode - Media type 
 * @param {map} $custom - Custom media features
 * 
 * @example
 * // Mobile-first: tablet and larger
 * @include media-query($from: tablet) { ... }
 * 
 * // Up to desktop
 * @include media-query($to: desktop) { ... }
 * 
 * // Range: phone to desktop-small
 * @include media-query($from: phone, $to: desktop-small) { ... }
 * 
 * // With custom features
 * @include media-query($from: tablet, $custom: (orientation: landscape, hover: hover)) { ... }
 */
@mixin media-query(
  $from: null,
  $to: null,
  $mode: screen,
  $custom: ()
) {
  
  @if $from and not map-has-key($breakpoints, $from) {
    @error "Breakpoint `#{$from}` not found. Available: #{map-keys($breakpoints)}";
  }
  
  @if $to and not map-has-key($breakpoints, $to) {
    @error "Breakpoint `#{$to}` not found. Available: #{map-keys($breakpoints)}";
  }
  
  $conditions: ();
  
  @if $mode {
    $conditions: append($conditions, $mode);
  }
  
  @if $from {
    $min-value: breakpoint($from);
    $conditions: append($conditions, "(min-width: #{$min-value})");
  }
  
  @if $to {
    $max-value: breakpoint($to);
    $conditions: append($conditions, "(max-width: #{$max-value - 0.02px})");
  }
  
  @each $feature, $value in $custom {
    $conditions: append($conditions, "(#{$feature}: #{$value})");
  }
  
  $query: if(length($conditions) > 0, "#{string-unquote(join($conditions, ' and '))}", '');
  
  @if $query != '' {
    @media (#{$query}) {
      @content;
    }
  } @else {
    @content;
  }
}

/**
 * Shorthand mixins for common breakpoints
 */

@mixin from($breakpoint) {
  @include media-query($from: $breakpoint) {
    @content;
  }
}

@mixin to($breakpoint) {
  @include media-query($to: $breakpoint) {
    @content;
  }
}

@mixin between($from, $to) {
  @include media-query($from: $from, $to: $to) {
    @content;
  }
}

@mixin only($breakpoint) {
  $keys: map-keys($breakpoints);
  $index: index($keys, $breakpoint);
  
  @if not $index {
    @error "Breakpoint `#{$breakpoint}` not found";
  }
  
  // mobile
  @if $index == 1 {
    $next: nth($keys, $index + 1);
    @include media-query($to: $next) {
      @content;
    }
  }
  // Last breakpoint (desktop?)
  @else if $index == length($keys) {
    @include media-query($from: $breakpoint) {
      @content;
    }
  }
 
  @else {
    $next: nth($keys, $index + 1);
    @include media-query($from: $breakpoint, $to: $next) {
      @content;
    }
  }
}

/**
 * Modern viewport units with fallback
 * Uses dvh/dvw/dvmin/dvmax for dynamic viewport units
 */
@mixin dynamic-viewport($property, $value) {
  #{$property}: $value;
  
  // For older browsers
  @supports not (height: 100dvh) {
    @if str-index($value, 'dvh') {
      $fallback: str-replace($value, 'dvh', 'vh');
      #{$property}: $fallback;
    }
    @if str-index($value, 'dvw') {
      $fallback: str-replace($value, 'dvw', 'vw');
      #{$property}: $fallback;
    }
  }
}

// Helper function for string replacement
@function str-replace($string, $search, $replace: '') {
  $index: str-index($string, $search);
  
  @if $index {
    @return str-slice($string, 1, $index - 1) + $replace + 
           str-replace(str-slice($string, $index + str-length($search)), $search, $replace);
  }
  
  @return $string;
}

/**
 * Usage examples
 */
// .element {
//   // Default mobile style
//   padding: 1rem;
//   font-size: 1rem;
  
//   @include media-query($from: phone) {
//     padding: 1.5rem;
//     font-size: 1.125rem;
//   }
  
//   @include from(tablet) {
//     padding: 2rem;
//     font-size: 1.25rem;
//   }
  
//   @include to(desktop) {
//     max-width: 100%;
//   }
  
//   @include only(desktop-small) {
//     background-color: #f0f0f0;
//   }
  
//   @include media-query(
//     $from: tablet,
//     $custom: (
//       orientation: landscape,
//       hover: hover
//     )
//   ) {
//     &:hover {
//       transform: scale(1.05);
//     }
//   }
  
//   @include dark-mode {
//     background-color: #1a1a1a;
//     color: #ffffff;
//   }
  
//   @include reduced-motion {
//     transition: none;
//     animation: none;
//   }
  
//   @include dynamic-viewport(min-height, 100dvh);
// }

// @include media-query($mode: print) {
//   .no-print {
//     display: none !important;
//   }
  
//   body {
//     color: black !important;
//     background: white !important;
//   }
  
//   a {
//     color: black !important;
//     text-decoration: underline !important;
//   }
// }
